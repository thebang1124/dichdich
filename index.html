<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dịch Êđê - Việt</title>
    <!-- Thư viện Tailwind CSS để tạo giao diện đẹp và đáp ứng -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Thư viện Font Awesome cho các biểu tượng -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="container mx-auto p-8 bg-white rounded-2xl shadow-xl max-w-5xl w-full">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-6">
            Dịch Êđê - Việt
        </h1>
        <p class="text-center text-gray-600 mb-8">
            dịch văn bản và trích xuất từ hình ảnh.
        </p>

        <div class="flex flex-col md:flex-row items-center gap-6">
            <!-- Khung nhập liệu tiếng Êđê -->
            <div class="flex flex-col flex-1 w-full">
                <label for="ede-input" class="block text-lg font-semibold text-gray-700 mb-2">Tiếng Êđê</label>
                <textarea id="ede-input"
                    class="w-full h-80 p-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 resize-none text-gray-800"
                    placeholder="Nhập văn bản tiếng Êđê..."></textarea>
            </div>
            
            <!-- Biểu tượng mũi tên -->
            <div class="flex items-center justify-center p-2 text-gray-400">
                <i class="fas fa-arrows-alt-h text-2xl"></i>
            </div>

            <!-- Khung hiển thị tiếng Việt -->
            <div class="flex flex-col flex-1 w-full">
                <label for="viet-output" class="block text-lg font-semibold text-gray-700 mb-2">Tiếng Việt</label>
                <textarea id="viet-output"
                    class="w-full h-80 p-4 border border-gray-300 rounded-xl bg-gray-50 text-gray-800 resize-none"
                    readonly placeholder="Bản dịch sẽ xuất hiện ở đây..."></textarea>
            </div>
        </div>

        <div class="mt-8 flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="translate-button"
                class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300">
                <i class="fas fa-language mr-2"></i>
                Dịch văn bản
            </button>
            <button id="image-translate-button"
                class="w-full sm:w-auto px-6 py-3 bg-green-600 text-white font-bold rounded-full shadow-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-300">
                <i class="fas fa-image mr-2"></i>
                Dịch từ ảnh
            </button>
            <button id="search-button"
                class="w-full sm:w-auto px-6 py-3 bg-yellow-500 text-white font-bold rounded-full shadow-lg hover:bg-yellow-600 focus:outline-none focus:ring-4 focus:ring-yellow-300 transition-all duration-300"
                disabled>
                <i class="fas fa-search mr-2"></i>
                Tra cứu
            </button>
            <button id="clear-button"
                class="w-full sm:w-auto px-6 py-3 bg-red-500 text-white font-bold rounded-full shadow-lg hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 transition-all duration-300">
                <i class="fas fa-times mr-2"></i>
                Xóa
            </button>
        </div>

        <!-- Hidden file input for image upload -->
        <input type="file" id="image-input" accept="image/*" class="hidden">

        <!-- Khung thông báo và loading -->
        <div id="message-box" class="mt-4 p-4 text-center rounded-lg text-gray-600"></div>
    </div>

    <script>
        const edeInput = document.getElementById('ede-input');
        const vietOutput = document.getElementById('viet-output');
        const translateButton = document.getElementById('translate-button');
        const imageTranslateButton = document.getElementById('image-translate-button');
        const searchButton = document.getElementById('search-button');
        const imageInput = document.getElementById('image-input');
        const clearButton = document.getElementById('clear-button');
        const messageBox = document.getElementById('message-box');

        const DICTIONARY = {
            'abao': 'Ốc bươu', 'abăn': 'Cái chăn (mền)', 'abŭ': 'Cái hũ', 'adei': 'Em', 'adĕ': 'Hến',
            'adham': 'Một nhóm trong tộc người Êđê', 'adhan': 'Cành', 'adhei': 'Trán', 'adiê': 'Trời', 'adiê không': 'Nắng hạn',
            'adiê tlam': 'Xế chiều', 'adih': 'Kia', 'adôk': 'Còn', 'adrăng': 'Rơm rạ', 'adring': 'Hiên nhà sàn',
            'adrŏk': 'Con cóc', 'aduôn': 'Bà (nội)', 'adŭ': 'Phòng, Lớp, Cái ô', 'adŭ bruă': 'Văn phòng',
            'adŭ gĭt gai bruă kiă kriê': 'Phòng hành chính', 'adŭ tĭng yap': 'Phòng kế tín', 'adŭng': 'Mũi',
            'aê': 'Ông (nội)', 'aê êa drao': 'Bác sĩ', 'agam': 'Loạn luân', 'agha': 'Rễ', 'aguah': 'Buổi sáng',
            'aguăt': 'Con bọ cạp', 'ah': 'ạ', 'ai': 'Sức', 'ai hriăm': 'Học lực', 'ai êwa': 'Khí thế',
            'ai mĭn': 'Suy nghĩ', 'ajĭk': 'Éch', 'ak': 'Con quạ', 'akăt': 'Bụi (khóm)', 'akâo': 'Xin',
            'ala': 'Con rắn', 'ala čar': 'Tổ quốc', 'ala čar tač êngao': 'Nước ngoài', 'alah': 'Lười biếng',
            'alah alan': 'Uể oải', 'ală': 'Mắt', 'ală kĭng': 'Kính', 'ală mmăt': 'Cận thị',
            'alĕ': 'Nhả', 'aluê̆': 'Nhả', 'alê': 'Lè', 'alôk': 'Lột', 'alum akâo': 'Cầu xin',
            'alum kkuh': 'Kính thưa', 'alum mpŭ': 'Trân trọng', 'alŭ': 'Thôn', 'alŭ wăl': 'Vùng',
            'alŭ ƀuôn prŏng': 'Phố phường', 'alưñ': 'Gớm', 'am pul pui': 'Bóng đèn', 'ama': 'Bố (cha)',
            'amai': 'Chị', 'amâo': 'Không', 'amâo dah': 'Hay (hoặc)', 'amâo dưi': 'Không được',
            'amâo djŏ ai': 'Không vừa lòng', 'amâo djŏ knŏng': 'Chẳng những', 'amâo kpă': 'Bất chính',
            'amâo klă mngač': 'Bất minh', 'amâo răk': 'Bất cứ', 'amâo răk rai': 'Bất diệt',
            'amâo thâo knga': 'Vô ơn', 'amâo mâo tŭ ư': 'Phản đối', 'amiêt': 'Cậu', 'amĭ': 'Mẹ (má)',
            'amĭ ama hđeh': 'Phụ huynh', 'amlơ̆k': 'Cám', 'amra': 'Sẽ', 'amrak': 'Con công', 'amrê̆č': 'Ớt',
            'amung mtei': 'Buồng chuối', 'amung mdiê': 'Bông lúa', 'amung kngan': 'Mu tay',
            'amung ŭn': 'Mõm lợn (heo)', 'amuôn': 'Cháu (cháu với cậu)', 'ana': 'Cây, giống cái',
            'anak': 'Con (dùng cho người)', 'anak ală': 'Con ngươi', 'anak ĭ': 'Trẻ sơ sinh',
            'anak rai': 'Con rồng', 'anal': 'Con sâu nái', 'anal kŏ': 'Cái gối', 'anăn': 'Tên, đó',
            'anăn kdrưh': 'Danh hiệu', 'anăp': 'Trước', 'anei': 'Đây', 'aneh': 'Dế', 'angĭn': 'Gió',
            'angĭn êbŭ': 'Bão', 'angưr': 'Ngẩng', 'anghar': 'Ngáy', 'anôk': 'Nơi', 'anôk dôk': 'Nơi ở',
            'anôk dôk êjai': 'Nơi tạm trú', 'anôk mjưh': 'Nơi dừng', 'anôk mjưh mran': 'Cảng',
            'anuă': 'Cái cưa', 'anŭng': 'Tuổi', 'anur': 'Con dũi', 'anut': 'Cái cúc áo', 'añŭ': 'Hạt cườm',
            'añuê': 'Chiếu', 'añhuôr': 'Duỗi', 'añhuih': 'Hỉ', 'ao': 'Áo', 'ap': 'Đè, Bịt, úp, Chườm',
            'ap gư̆': 'Đàn áp', 'aprŏng': 'Bác (chị của mẹ)', 'ară anei': 'Hiện nay', 'arăn': 'Rặn',
            'arăng': 'Người ta', 'areh': 'Con rệp', 'ariêng': 'Con cua', 'aruăt': 'Gân', 'arul': 'Họ của người Êđê',
            'arưp aram': 'Đe dọa', 'asăp': 'Lời, Khói', 'asăp mtrŭn': 'Nghị quyết', 'asăr': 'Hạt, Viên',
            'aseh': 'Con ngựa', 'asâo': 'Con chó', 'asei': 'Thân', 'asei mlei': 'Thân thể', 'asei wah': 'Lưỡi câu',
            'atăt': 'Đón', 'atâo': 'Người chết (thi hài người chết)', 'ai tiê': 'Tấm lòng', 'ai tiê jăk': 'Sự tốt bụng',
            'ai tiê kriăng': 'Chăm chỉ', 'atŭt': 'Đốt', 'atiêng': 'Nhánh', 'awa': 'Bác (anh trai và chị gái của bố)',
            'awak': 'Cái thìa', 'awak boh': 'Cái muôi (làm bằng tre)', 'awan': 'Khuôn', 'awăt': 'Yếu',
            'ayŏng': 'Anh', 'ayŏng khua': 'Anh cả', 'al': 'Măng', 'al čôñ': 'Giận hờn', 'am': 'Nướng',
            'at': 'Vẫn, Cũng', 'ba': 'Mang', 'ba tian': 'Mang bầu', 'ba kđi': 'Bồi thường',
            'bai': 'Giỏ', 'bai đih': 'Nôi (em bé)', 'ban': 'Trườn', 'bă': 'Đụng', 'băk': 'Đeo (vào cổ)',
            'bĕ': 'Thôi!', 'bê': 'Dê (con vật)', 'bhang': 'Hè', 'bhañ': 'Hắt hơi', 'bhĭ': 'Tên của một loài chim',
            'bhiăn': 'Thường', 'bhiâo': 'Một lúc', 'bhiâo hin': 'Chóng vánh', 'bhiâo riâo rit': 'Chốc lát',
            'bhĭr': 'Nhẹm', 'bhĭt': 'Rậm', 'bhĭt pum': 'Bụi rậm', 'bhĭt dliê': 'Bụi rậm',
            'bhôk gah': 'Ngăn nhỏ ở gian trước nhà sàn Êđê', 'bhŏng bhŏng': 'Ào ạt', 'bhung aguah': 'Suốt đêm',
            'bhung bhang': 'Sáng sủa', 'bi': 'Còn, Phải', 'bi ăl': 'Giận nhau', 'bi blŭ': 'Đàm thoại',
            'bi čĭk': 'Vật nhau', 'bi dơ̆k bi dria': 'Rộn rã', 'bi êdah': 'Thể hiện', 'bi hlĭ': 'Hòa thuận',
            'bi hdơr': 'Tưởng nhớ', 'bi kbưi': 'Cách ly', 'bi kjăp': 'Củng cố', 'bi kmiêk': 'Ném nhau',
            'bi lar': 'Trau dồi', 'bi leh': 'Hoàn thành', 'bi liê': 'Tiêu', 'bi lir': 'Liền nhau (sát)',
            'bi lông': 'Thi (thi cử), Đua', 'bi lui': 'Ly dị', 'bi mđĭ': 'Nâng cao', 'bi mĭn': 'Suy nghĩ',
            'bi mlih': 'Thay đổi', 'bi mtlaih': 'Giải thích', 'bi ruê̆': 'Kết thúc', 'bi rŭng': 'Gây rối',
            'bi ŭk bi ăk': 'Tấp nập', 'bi yông': 'Lại lại nhau', 'biêng': 'Đập', 'biêr': 'Lùn, Thấp',
            'bih': 'Thuộc nhóm dân tộc Êđê', 'bip': 'Vịt', 'bip êa': 'Con vịt nước', 'bir': 'Vỉa hè',
            'biut': 'Mây', 'blač': 'Mổ', 'blah': 'Bổ, Chẻ', 'blang': 'Nở (hoa)', 'blao': 'Nhát',
            'bliư̆': 'Lật, Lần', 'blô': 'Bầu (bĩnh)', 'blŭ': 'Nói', 'blŭ bi hmư̆': 'Nói khóe',
            'blŭ mhriêng': 'Nói bóng', 'blŭ tlao': 'Cười nói', 'blŭ wah wơ': 'Nói trống không',
            'blŭ myâo': 'Nói khéo', 'blŭ yăl': 'Nói năng', 'boh': 'Quả, Trứng, giặt, từ dùng để đếm cái',
            'boh anăn': 'Danh từ', 'boh anut': 'Cái khuy (cúc áo)', 'boh areh': 'Long não',
            'boh bip êđai': 'Trứng vịt lộn', 'boh dlông': 'Chiều cao', 'boh đê̆č': 'Hoa văn',
            'boh blŭ': 'Từ ngữ (từ vựng)', 'boh blŭ mčuê': 'Giới từ', 'boh ƀai': 'Diện tích',
            'boh ƀleh': 'Thận', 'boh hră': 'Chữ', 'boh kbưi': 'Cách xa', 'boh jhat': 'Sự xấu xa',
            'boh jing': 'Tính từ, Thành quả', 'boh kê̆ñ': 'Bánh chè', 'boh kŏ': 'Cái đầu',
            'boh kpăt': 'Bồ hòn', 'boh lăn': 'Trái đất', 'boh m’ô̆': 'Hầu (người), Xoài rừng (hột nhỏ)',
            'boh mdê': 'Đặc thù', 'boh mtuh': 'Lựu đạn', 'boh nik': 'Nhất là', 'boh nak': 'Nhất là',
            'boh păm': 'Bồ kết', 'boh pha': 'Bắp vế', 'boh phŭn': 'Nội dung', 'boh pia': 'Phụ âm',
            'boh tih': 'Bắp chân', 'boh tluôn': 'Cái mông', 'bŏ': 'Đầy', 'bŏk': 'Sưng',
            'bŏk yơi': 'Quai bị', 'bŏk wi wu': 'Sưng vù', 'bŏng bŭ': 'Bèm bẹp', 'bông': 'Quan tài (hòm)',
            'bơ bhô': 'Uổng ộc', 'braih': 'Gạo', 'braih ka hroh': 'Gạo lức', 'braih mkuê̆': 'Gạo (gạo thóc nói chung)',
            'brang': 'Gai (cây gai)', 'brei': 'Cho', 'bring': 'Rỉ', 'brô̆': 'Đàn',
            'bru bra': 'Tán loạn', 'brŭ': 'Thối', 'brŭ hiă': 'Thối hoắc', 'bruă': 'Việc',
            'bruă čuăn': 'Quy định', 'bruă kmrơ̆ng dhông': 'Việc công',
            'bruă lŏ hma': 'Nông nghiệp', 'bruă lĭng kahan': 'Quân sự', 'bruă mă': 'Nghề nghiệp, làm việc',
            'bruă mă hgăm': 'Công tác bí mật', 'bruă mă kơ lu mnuih': 'Việc công',
            'bruă mdrao mgŭn': 'Y tế, Y khoa', 'bruă mgang ala čar': 'Quốc phòng',
            'bruă mjeh mjuk': 'Công tác dân vận', 'bruă tĭng yap': 'Kế tín', 'bruă truh': 'Sự việc',
            'bruă yua': 'Công dụng', 'bruă yua kiê kngan': 'Nghề thủ công', 'brung': 'Đốm',
            'brung brê̆č': 'Sặc sỡ', 'buê': 'Hoa tai (bông tai)', 'buh': 'Đeo (ở tay), Trỉa',
            'buk': 'phồng, nệm', 'bum': 'Mù', 'bŭr': 'Hạch', 'bur': 'Cháo', 'bŭ': 'Con gái',
            'bŭč': 'Nhổ', 'bŭl': 'Cuộn (dây)', 'bŭng': 'Cái gùi', 'bư̆': 'Rào',
            'bư̆ guê': 'Đắp bờ', 'bưn': 'Vườn (ở xa nhà)', 'bưng': 'Bát', 'bưng gŏ': 'Nồi niêu',
            'ƀah': 'Mẻ (sứt)', 'ƀah dah': 'Vừa', 'ƀai': 'rộng, ác ôn', 'ƀai kdai': 'Rộng rãi',
            'ƀaih': 'Ôi (chỉ sự ngạc nhiên)', 'ƀaih haih': 'Ôi chà', 'ƀal': 'Đẽo', 'ƀă': 'Địu',
            'ƀă anak lung êra': 'Chửa con so', 'ƀă pum': 'Chửa hoang', 'ƀăl': 'Chát',
            'ƀăng': 'Lỗ, Hốc, Hầm, Hang (động)', 'ƀăng bhă': 'Cái cửa (dùng chung)',
            'ƀăng bhă điêt': 'Cửa sổ', 'ƀăng bhă prŏng': 'Cửa ra vào', 'ƀăng đuê̆ dăp': 'Hầm hào',
            'ƀăng eh': 'Hậu môn', 'ƀăng êa': 'Giếng nước', 'ƀăng êgei': 'Miệng (mồm)',
            'ƀăng jang': 'Cổng', 'ƀâo': 'Hôi', 'ƀâo brŭ': 'Hôi thối', 'ƀâo iu': 'Ôi thiu',
            'ƀâo khơr': 'Khai (mùi khai)', 'ƀâo kmĭl': 'Hôi nách', 'ƀâo mnâo': 'Đánh hơi',
            'ƀâo mngưi': 'Thơm (mùi thơm)', 'ƀap': 'Cái ví', 'ƀar': 'Mặc (váy)',
            'ƀar h’ô': 'Ăn mặc', 'ƀĕ': 'Cái, Cây', 'ƀê̆č': 'Đặt bẫy, Bẫy chuột', 'ƀê̆č ƀê̆č': 'Lẩm bẩm',
            'ƀê̆ñ': 'Bánh', 'ƀê̆ñ hră': 'Đường ăn', 'ƀê̆ñ kpŭng': 'Bánh mè', 'ƀê̆ñ mlim': 'Kẹo',
            'ƀhĭ': 'Nát', 'ƀhĭ ƀhê̆ñ': 'Li ti', 'ƀhiăr': 'Phẳng lì', 'ƀhơi': 'Đáng', 'ƀhu': 'Phơi',
            'ƀhư': 'Rộ', 'ƀhŭl': 'Bụi mù', 'ƀhur': 'Thổi', 'ƀi': 'Bi', 'ƀiă': 'Ít',
            'ƀiă dhit': 'Quá ít', 'ƀiă ƀiă': 'Chút ít', 'ƀiă dah': 'Nhưng', 'ƀiêk': 'Khóe miệng',
            'ƀiêp ƀiêp': 'Nhai nhải', 'ƀiêr': 'Bia', 'ƀik ƀik': 'Nườm nượp', 'ƀĭng': 'Bạn',
            'ƀĭng găp': 'Bạn bè', 'ƀĭng khăp': 'Người yêu', 'ƀĭng kna': 'Đồng chí', 'ƀlă': 'Ốc sên',
            'ƀlĕ': 'Chảy, Mọc, Trổ', 'ƀlĕ eh': 'Ỉa', 'ƀlĕ êa ală': 'Rơi nước mắt',
            'ƀlĕ k’hŏ k’hang': 'Rít mồ hôi', 'ƀlĕ tlao': 'Phé cười', 'ƀlĕ k’ul': 'Buồn nôn',
            'ƀlê̆č ƀlir': 'Đểu', 'ƀlia': 'Láng', 'ƀling': 'Léo', 'ƀlĭp ƀlĭp': 'Chớp (ánh sáng)',
            'ƀlir': 'Dán', 'ƀlir ƀlir': 'Long lanh', 'ƀlĭt': 'Dính', 'ƀloh': 'Muỗi',
            'ƀlŏng ƀlŏng': 'Vẹo von', 'ƀlŏng ƀlut': 'Lênh đênh', 'ƀlô': 'Một nhánh người thuộc dân tộc Êđê',
            'ƀlông': 'Gòn', 'ƀluôn': 'Muỗi', 'ƀlŭng': 'Hố', 'ƀô': 'Mê', 'ƀôñ': 'Bện',
            'ƀô̆': 'Mặt', 'ƀô̆mta': 'Khuôn mặt', 'ƀơ̆ng': 'Ăn, Cháy, Sắc (bén)', 'ƀơ̆ng dôč': 'Ăn vặt',
            'ƀơ̆ng hŏng kngan': 'Ăn bốc', 'ƀơ̆ng ngăn': 'Ăn hối lộ', 'ƀrĭk': 'Gạch',
            'ƀrah ƀrơp': 'Long đong', 'ƀrô mơh': 'May ra', 'ƀrôč': 'Thủng, Dột',
            'ƀruêh': 'Bàn chải', 'ƀrôk ƀrôk': 'Oang oang', 'ƀrŏng': 'Ngọn (cây)',
            'ƀru ƀra': 'Tán loạn', 'ƀruih': 'Bụi', 'ƀruih ƀram': 'Bụi bặm', 'ƀrŭk ƀrŭk': 'Sùng sục',
            'ƀrư̆ ƀrư̆': 'Dần dần', 'brư̆ hruê ƀrư̆': 'Càng ngày càng', 'ƀuah': 'Trách',
            'ƀuăn': 'Hứa', 'ƀuăn rơ̆ng': 'Cam đoan', 'ƀuh': 'Thấy', 'ƀuh klei soh': 'Thấy khuyết điểm',
            'ƀun': 'Nghèo', 'ƀun ƀin': 'Nghèo nàn', 'ƀuôn': 'Buôn, Ấp', 'ƀuôn hgŭm': 'Phường',
            'ƀuôn phŭn': 'Thủ đô', 'ƀuôn prŏng': 'Thành phố', 'ƀuôn sang': 'Làng mạc', 'ƀuôr': 'Khơi (mương)',
            'ƀur': 'Bụi cây nhỏ (lùm cây)', 'ƀŭk': 'Tóc', 'ƀŭk ƀiêk': 'Tóc tai', 'ƀŭl ƀŭl': 'Đông đúc',
            'bŭl': 'lưỡi dao', 'bŭr': 'tóc', 'yŭ': '(hướng) Tây', 'yŭ ngŏ': 'phương hướng',
            'yŭk': 'đũng', 'yŭm': 'măn (nhiều)', 'yŭn': 'rung', 'yŭng jing': 'đứng sững',
            'yŭr': 'dái', 'yŭr knga': 'dái tai', 'yŭr tluôn': 'mông', 'yưh yưp': 'chậm chạp, lụn bại',
            'uăt': 'gân, sợi', 'čar': 'tỉnh, chẻ', 'djă': 'cầm, giữ', 'đi': 'leo, trèo, cưỡi, lên, đi',
            'hăng': 'bằng với', 'bẽ': 'cái, chỉ số cây', 'biẽ': 'chảy, mọc, trổ', 'buh': 'đeo, tỉa (lúa)',
            'čim': 'thịt, chim', 'čoh': 'mổ, cắn, cuốc', 'leh': 'đã, rồi, xong', 'msăm': 'đắp (chăn), chua',
            'êluih': 'rẻ, dễ', 'mta': 'lưỡi (dao), thứ, loại, món', 'tal': 'xẻ, thứ', 'khök': 'gõ, cụng',
            'bi': 'còn, phải', 'klei': 'tiếng dây, đào, sự việc, bài, điều...', 'boh': 'quả, trái, giặt, chiếc, hòn',
            'băng': 'ăn, cháy, bén', 'dôk': 'ở, đang, ngồi, lấy (vợ, chồng)', 'kkiêng': 'sinh đẻ, khuỷu tay, góc',
            'khua': 'trường, giả, người lãnh đạo', 'lỡ': 'ruộng, nữa, lại', 'djō': 'trúng, đúng',
            'drei': 'chúng ta, ta, số đếm (con vật)', 'khăp': 'thích, yêu', 'cô': 'cháu (nội, ngoại); gội',
            'lõ wit hriăm': 'ôn luyện', 'kơ nai mtô': 'cho giáo viên', 'kgũ dồng': 'đứng lên',
            'lõ hma': 'nông nghiệp', 'yă ngă': 'tại sao, vì sao', 'hd^p mda': 'sống', 'hluê djo\\': 'theo đúng',
            'hdră bhia\\n': 'đường lối pháp luật', 'pui kmlà': 'điện', 'ãlan ãrä ãbat': 'đường giao thông',
            'sang hrà': 'trường học', 'sang ãa drao': 'bệnh viện', 'păt ]iàng': 'tất cả, hết thảy',
            'ru\\mdå\\ng': 'xây dựng', 'âru': 'giúp', 'brei': 'cho', 'hdruäm hră': 'sách vở',
            'mtô mblang': 'giảng dạy', 'ngă bruă knŭk kna': 'làm việc nhà nước', 'ñu': 'nó, anh ấy',
            'ung': 'vợ', 'mỗ': 'chồng', 'dôk mdhê': 'đang sống', 'sang kâo': 'nhà tôi',
            'ti mrô': 'ở số', 'êlan': 'đường', 'sang kâo mâo': 'nhà tôi có', 'čô mnuih': 'người',
            'thũn anei': 'năm nay',
            'mâo': 'có',
            'ngă bruă': 'làm việc',
            'anak khua': 'con cả',
            'mduôn': 'qua đời, mất',
            'kkuh kơ nai mtô': 'chào giáo viên',
            'klei yuăn': 'tiếng kinh'
        };

        let lastUntranslatedWord = '';

        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = 'mt-4 p-4 text-center rounded-lg';
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-700');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-700');
            } else if (type === 'info') {
                messageBox.classList.add('bg-blue-100', 'text-blue-700');
            } else {
                messageBox.classList.add('bg-gray-100', 'text-gray-600');
            }
        }

        function capitalizeFirstLetter(string, originalWord) {
            if (originalWord && originalWord.length > 0 && originalWord[0] === originalWord[0].toUpperCase() && originalWord[0] !== originalWord[0].toLowerCase()) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }
            return string;
        }

        async function translateTextWithAI(text) {
            if (!text.trim()) {
                vietOutput.value = '';
                searchButton.disabled = true;
                return;
            }

            showMessage('Đang dịch văn bản...', 'info');
            
            // First, try to translate using the local dictionary for speed and consistency
            const wordsAndPunctuation = text.match(/[\p{L}0-9\u0300-\u036f\-’'#&%\[\]]+|\s+|[.,!?;:]/gu) || [];
            let translatedText = '';
            let untranslatedWords = new Set();
            let i = 0;
            
            while (i < wordsAndPunctuation.length) {
                let part = wordsAndPunctuation[i];
                let matched = false;

                // Check for multi-word phrases first
                for (let j = 4; j > 1; j--) {
                    if (i + j <= wordsAndPunctuation.length) {
                        const phraseParts = wordsAndPunctuation.slice(i, i + j).map(p => p.trim()).filter(p => p !== '');
                        if (phraseParts.length > 1) {
                            const phrase = phraseParts.join(' ').toLowerCase();
                            if (DICTIONARY[phrase]) {
                                translatedText += capitalizeFirstLetter(DICTIONARY[phrase], wordsAndPunctuation.slice(i, i + j).join(' ').trim());
                                i += j;
                                matched = true;
                                break;
                            }
                        }
                    }
                }

                if (!matched) {
                    if (part.trim() === '' || /[.,!?;:]/.test(part)) {
                        translatedText += part;
                        i++;
                    } else {
                        const cleanedPart = part.toLowerCase().replace(/[\[\]#&%’']|\s/g, '');
                        const translatedWord = DICTIONARY[cleanedPart];
                        if (translatedWord) {
                            translatedText += capitalizeFirstLetter(translatedWord, part);
                        } else {
                            untranslatedWords.add(cleanedPart);
                            translatedText += `[${part}]`;
                        }
                        i++;
                    }
                }
            }

            // If there are untranslated words, use AI for a more comprehensive translation
            if (untranslatedWords.size > 0) {
                let retries = 0;
                const maxRetries = 5;
                let delay = 1000;

                while (retries < maxRetries) {
                    try {
                        const prompt = `Translate the following text from Êđê to Vietnamese. If a word or phrase is in English, translate it to Vietnamese. Maintain the original formatting and punctuation. Use the provided dictionary for known words if possible. Here is the dictionary: ${JSON.stringify(DICTIONARY)}.
                        \nÊđê text: ${text}`;
                        
                        const payload = {
                            contents: [{ role: "user", parts: [{ text: prompt }] }]
                        };
                        const apiKey = "AIzaSyBVCTx8fPnGWFprwoT9bgixio_NUgvNG4k";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429) {
                                retries++;
                                await new Promise(res => setTimeout(res, delay));
                                delay *= 2;
                                continue;
                            } else {
                                throw new Error(`API Error: ${response.statusText}`);
                            }
                        }

                        const result = await response.json();
                        const translatedAI = result?.candidates?.[0]?.content?.parts?.[0]?.text || '';
                        vietOutput.value = translatedAI.trim();
                        lastUntranslatedWord = [...untranslatedWords].join(', ');
                        searchButton.disabled = false;
                        showMessage('Bản dịch hoàn tất.', 'success');
                        return;

                    } catch (error) {
                        console.error('Lỗi khi dịch AI:', error);
                        showMessage(`Lỗi khi dịch AI: ${error.message}`, 'error');
                        vietOutput.value = translatedText.replace(/\[|\]/g, ''); // Fallback to dictionary translation without brackets
                        searchButton.disabled = true;
                        break;
                    }
                }
            } else {
                // If all words are in the dictionary, just use that result
                vietOutput.value = translatedText;
                lastUntranslatedWord = '';
                searchButton.disabled = true;
                showMessage('Bản dịch hoàn tất bằng từ điển.', 'success');
            }
        }

        async function translateImage() {
            const file = imageInput.files[0];
            if (!file) {
                showMessage('Vui lòng chọn một hình ảnh.', 'error');
                return;
            }

            showMessage('Đang trích xuất văn bản từ ảnh...', 'info');

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = async () => {
                const base64ImageData = reader.result.split(',')[1];
                const prompt = "Trích xuất tất cả văn bản từ hình ảnh này.";

                const payload = {
                    contents: [{
                        role: "user",
                        parts: [
                            { text: prompt },
                            {
                                inlineData: {
                                    mimeType: file.type,
                                    data: base64ImageData
                                }
                            }
                        ]
                    }]
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let retries = 0;
                const maxRetries = 5;
                let delay = 1000;

                while (retries < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429) {
                                retries++;
                                await new Promise(res => setTimeout(res, delay));
                                delay *= 2;
                                continue;
                            } else {
                                throw new Error(`API Error: ${response.statusText}`);
                            }
                        }

                        const result = await response.json();
                        const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || '';
                        
                        if (text.trim()) {
                            edeInput.value = text.trim();
                            translateTextWithAI(edeInput.value);
                        } else {
                            showMessage('Không tìm thấy văn bản trong ảnh.', 'error');
                        }
                        return;

                    } catch (error) {
                        console.error('Lỗi khi gọi API:', error);
                        showMessage(`Lỗi khi dịch ảnh: ${error.message}`, 'error');
                        break;
                    }
                }
            };
        }

        function handleSearch() {
            if (lastUntranslatedWord) {
                const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(lastUntranslatedWord)} từ điển Êđê`;
                window.open(searchUrl, '_blank');
            } else {
                const selectedText = window.getSelection().toString().trim();
                if (selectedText) {
                    const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(selectedText)} từ điển Êđê`;
                    window.open(searchUrl, '_blank');
                } else {
                    showMessage('Vui lòng nhập hoặc chọn một từ để tra cứu.', 'error');
                }
            }
        }

        translateButton.addEventListener('click', () => translateTextWithAI(edeInput.value));
        edeInput.addEventListener('input', () => translateTextWithAI(edeInput.value));
        imageTranslateButton.addEventListener('click', () => imageInput.click());
        imageInput.addEventListener('change', translateImage);
        searchButton.addEventListener('click', handleSearch);

        clearButton.addEventListener('click', () => {
            edeInput.value = '';
            vietOutput.value = '';
            lastUntranslatedWord = '';
            searchButton.disabled = true;
            showMessage('Đã xóa tất cả.', 'success');
            edeInput.focus();
        });
    </script>
</body>
</html>
